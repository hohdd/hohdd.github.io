<!DOCTYPE html><html lang="vi"><title>[Unity Coding] How-To</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="[Unity Coding] How-To"><meta name="author" content="Dong Ho"> <META NAME="ROBOTS" CONTENT="noindex, nofollow, noarchive, nosnippet, noimageindex"><link rel="manifest" href="/assets/manifest.json"><meta name="theme-color" content="#317EFB"/><link href="/assets/css/main.css" rel="stylesheet" media="all"><link rel="stylesheet" href="/assets/css/delay.css" media="none" onload="if(media!='all')media='all'"> <noscript><link rel="stylesheet" href="/assets/css/delay.css"></noscript><link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /><link rel="shortcut icon" type="image/png" href="/assets/img/favicon.png"><body onload="_documentReady_()"><nav class="w3-sidebar w3-black w3-animate-opacity w3-xxlarge z-index-999" style="display:none;padding-top:100px;top:0px;" id="menuElm"><div class="w3-bar-block w3-center"><h1 class="w3-bar-item w3-button w3-text-grey w3-hover-black"> <a href="/pages/about" title="About">About</a></h1><h1 class="w3-bar-item w3-button w3-text-grey w3-hover-black"> <a href="/pages/authors" title="Teams">Teams</a></h1><h1 class="w3-bar-item w3-button w3-text-grey w3-hover-black"> <a href="/pages/categories" title="Archives">Archives</a></h1><h1 class="w3-bar-item w3-button w3-text-grey w3-hover-black"> <a href="/collections" title="Collections">Collections</a></h1><h1 class="w3-bar-item w3-button w3-text-grey w3-hover-black"> <a href="/pages/tools" title="Tools">Tools</a></h1></div></nav><div class="w3-top z-index-9999 w3-white" id="navbar"><div class="w3-bar w3-padding w3-card opacity-transition-hover w3-display-container" style="letter-spacing:4px;"><div class="w3-display-left w3-padding w3-hide-small"> <img id="hat" src="/assets/img/kmw/hat63.png"> <a href="/" class="w3-bar-item">Mr.Winter</a></div><div class="w3-display-middle w3-hide-small"></div><div class="w3-right" > <span class="material-icons w3-button" id="menuIcon" onclick="toggleMenu()" title="Menu">menu</span></div></div></div><div class="w3-content w3-panel w3-animate-opacity-slow" style="max-width:1100px"><main><div class="w3-padding-32"></div><article id="articleBody"><h2>How-To</h2><span class="opacity-transition-hover"> <span class="author"> <a href="/authors/dongho" class="hvr-float-shadow">Dong Ho</a> </span> <time datetime="2020-05-15T14:26:14+07:00" class="by-line">15 May 2020 <span> <a href="/collections/game-development#Coding" class="hvr-float-shadow">Coding</a> </span> </time> <span title="reading time">· about 18 mins read </span> </span><div class="w3-section konamiHide"><div id="search-container"> <label> <span class="dh-unnecessary">Tìm kiếm</span> <input type="text" id="search-input" placeholder="Hoặc tìm bài viết khác..." class="w3-margin-top"> </label><div id="results-container" class="w3-card"></div></div></div><div class="w3-section konamiHide"><div class="content-speech"><ul class="toc-nav dh-black-8 w3-animate-opacity dh-padding-right-1em"><li class="toc-entry toc-h2"><a href="#editor" spy-toc="Editor">Editor</a><li class="toc-entry toc-h2"><a href="#runtime" spy-toc="Runtime">Runtime</a><li class="toc-entry toc-h2"><a href="#patterns" spy-toc="Patterns">Patterns</a><ul><li class="toc-entry toc-h3"><a href="#tạo-monobehaviour-singleton" spy-toc="Tạo MonoBehaviour Singleton">Tạo MonoBehaviour Singleton</a><li class="toc-entry toc-h3"><a href="#sử-dụng-scriptableobject" spy-toc="Sử dụng ScriptableObject">Sử dụng ScriptableObject</a><li class="toc-entry toc-h3"><a href="#custom-inspector" spy-toc="Custom Inspector">Custom Inspector</a><li class="toc-entry toc-h3"><a href="#draw-gizmos-với-gimozdrawutility" spy-toc="Draw Gizmos với GimozDrawUtility">Draw Gizmos với GimozDrawUtility</a><li class="toc-entry toc-h3"><a href="#global-configuration-manager" spy-toc="Global Configuration Manager">Global Configuration Manager</a><li class="toc-entry toc-h3"><a href="#xử-lý-start-và-load-scene-ở-các-levels" spy-toc="Xử lý Start và Load Scene ở các Levels">Xử lý Start và Load Scene ở các Levels</a><li class="toc-entry toc-h3"><a href="#tự-implement-một-touch-control-mobile-joysticks" spy-toc="Tự implement một Touch Control Mobile (Joysticks)">Tự implement một Touch Control Mobile (Joysticks)</a><li class="toc-entry toc-h3"><a href="#todo" spy-toc="TODO…">TODO…</a></ul><li class="toc-entry toc-h2"><a href="#investigate" spy-toc="Investigate">Investigate</a><ul><li class="toc-entry toc-h3"><a href="#battlecity" spy-toc="BattleCity">BattleCity</a><ul><li class="toc-entry toc-h4"><a href="#read-json" spy-toc="Read Json">Read Json</a><li class="toc-entry toc-h4"><a href="#khởi-tạo-map-và-enemies" spy-toc="Khởi tạo Map và Enemies">Khởi tạo Map và Enemies</a><li class="toc-entry toc-h4"><a href="#sử-dụng-setter-để-implement-luồng-game" spy-toc="Sử dụng Setter để implement luồng game">Sử dụng Setter để implement luồng game</a><li class="toc-entry toc-h4"><a href="#joystick" spy-toc="Joystick">Joystick</a><li class="toc-entry toc-h4"><a href="#battlecity-take-note" spy-toc="BattleCity Take Note">BattleCity Take Note</a></ul></ul><li class="toc-entry toc-h2"><a href="#linh-tinh" spy-toc="Linh tinh">Linh tinh</a></ul><h2 id="editor"> <a class="anchor" href="#editor" aria-hidden="true" spy-title="Editor"><span class="octicon octicon-link"></span></a>Editor</h2><h2 id="runtime"> <a class="anchor" href="#runtime" aria-hidden="true" spy-title="Runtime"><span class="octicon octicon-link"></span></a>Runtime</h2><h2 id="patterns"> <a class="anchor" href="#patterns" aria-hidden="true" spy-title="Patterns"><span class="octicon octicon-link"></span></a>Patterns</h2><h3 id="tạo-monobehaviour-singleton"> <a class="anchor" href="#t%E1%BA%A1o-monobehaviour-singleton" aria-hidden="true" spy-title="Tạo MonoBehaviour Singleton"><span class="octicon octicon-link"></span></a>Tạo MonoBehaviour Singleton</h3><ul><li>Mục đích: để truy cập bất cứ lúc nào, ở bất cứ đâu<li>Đối tượng áp dụng: những MonoBehaviour thiết yếu được sử dụng nhiều nơi (VD: GameManager, LevelManager, HUDManager, TimeManager, ObjectiveManager… )<li>Thực hiện:<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">...</span>
  <span class="k">public</span> <span class="k">static</span> <span class="n">LevelManager</span> <span class="n">Instance</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">private</span> <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">Instance</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span> <span class="c1">// singleton</span>
  <span class="p">}</span>
  <span class="p">...</span>
</code></pre></div></div></ul><h3 id="sử-dụng-scriptableobject"> <a class="anchor" href="#s%E1%BB%AD-d%E1%BB%A5ng-scriptableobject" aria-hidden="true" spy-title="Sử dụng ScriptableObject"><span class="octicon octicon-link"></span></a>Sử dụng ScriptableObject</h3><ul><li>Mục đích: có thể sử dụng cho nhiều mục đích khác nhau.<li>Ví dụ về <strong>Event-Listener</strong><div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">/// -------------------- GameEvent -------------------------</span>
  <span class="c1">/// &lt;summary&gt;</span>
  <span class="c1">/// Usage: là một 'ScriptableObject' để pool sẵn một list các Listener...</span>
  <span class="c1">/// - Tạo các Event khác nhau trong Assets (VD: ToggleIngameMenuEvt, PlayerDyingEvt...)</span>
  <span class="c1">/// - Tại nơi muốn Raise event này sẽ kéo reference vào biến rồi gọi hàm Raise() trên biến đó</span>
  <span class="c1">/// &lt;/summary&gt;</span>
  <span class="p">[</span><span class="nf">CreateAssetMenu</span><span class="p">(</span><span class="n">menuName</span> <span class="p">=</span> <span class="s">"DongHD/Events/Game Event"</span><span class="p">)]</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">GameEvent</span> <span class="p">:</span> <span class="n">ScriptableObject</span>
  <span class="p">{</span>
      <span class="p">[</span><span class="n">NonSerialized</span><span class="p">]</span> <span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">GameEventListener</span><span class="p">&gt;</span> <span class="n">listeners</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">GameEventListener</span><span class="p">&gt;();</span>

      <span class="k">public</span> <span class="k">void</span> <span class="nf">Raise</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">listeners</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
          <span class="p">{</span>
              <span class="n">listeners</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">OnEventRaised</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
          <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">public</span> <span class="k">void</span> <span class="nf">RegisterListener</span><span class="p">(</span><span class="n">GameEventListener</span> <span class="n">listener</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="n">listeners</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">public</span> <span class="k">void</span> <span class="nf">UnregisterListener</span><span class="p">(</span><span class="n">GameEventListener</span> <span class="n">listener</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="n">listeners</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">/// -------------------- GameEventListener -------------------------</span>
  <span class="c1">/// &lt;summary&gt;</span>
  <span class="c1">/// Usage: là một 'MonoBehaviour' để đăng ký Listener vào Event và cho phép Script khác (cùng GameObject) triển khai 'UnityAction'...</span>
  <span class="c1">/// - Tại GameObject muốn xử lý một tác vụ khi có một sự kiện nào đó xảy ra sẽ được add Component này.</span>
  <span class="c1">/// - Tại Script trong cùng GameObject sẽ triển khai gameResponse (UnityEvent) của Component này.</span>
  <span class="c1">/// &lt;/summary&gt;</span>
  <span class="p">[</span><span class="nf">AddComponentMenu</span><span class="p">(</span><span class="s">"DongHD/Events/Game Event Listener"</span><span class="p">)]</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">GameEventListener</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
  <span class="p">{</span>
      <span class="k">public</span> <span class="n">GameEvent</span> <span class="n">eventAsset</span><span class="p">;</span>
      <span class="k">public</span> <span class="n">UnityAction</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">gameAction</span><span class="p">;</span>

      <span class="k">private</span> <span class="k">void</span> <span class="nf">OnEnable</span><span class="p">()</span>
      <span class="p">{</span>
          <span class="n">eventAsset</span><span class="p">.</span><span class="nf">RegisterListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">private</span> <span class="k">void</span> <span class="nf">OnDisable</span><span class="p">()</span>
      <span class="p">{</span>
          <span class="n">eventAsset</span><span class="p">.</span><span class="nf">UnregisterListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
        
      <span class="k">public</span> <span class="k">void</span> <span class="nf">OnEventRaised</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="n">gameAction</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">/// -------------------- Usage -------------------------</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">MessageHUDController</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
  <span class="p">{</span>
      <span class="p">...</span>
      <span class="p">[</span><span class="nf">Tooltip</span><span class="p">(</span><span class="s">"Listener Event để tạo MessageHUD"</span><span class="p">)]</span> <span class="k">public</span> <span class="n">GameEventListener</span> <span class="n">evtCreateMessageHUD</span><span class="p">;</span>

      <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
      <span class="p">{</span>
          <span class="c1">// triển khai UnityAction trong Listener (gọi hàm 'CreateMessage')</span>
          <span class="n">evtCreateMessageHUD</span><span class="p">.</span><span class="n">gameAction</span> <span class="p">+=</span> <span class="p">(</span><span class="kt">object</span> <span class="n">txt</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nf">CreateMessage</span><span class="p">(</span><span class="n">txt</span> <span class="k">as</span> <span class="kt">string</span><span class="p">);</span> <span class="p">};</span>
      <span class="p">}</span>

      <span class="k">public</span> <span class="k">void</span> <span class="nf">CreateMessage</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="c1">// doing something when event raised</span>
      <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div></ul><h3 id="custom-inspector"> <a class="anchor" href="#custom-inspector" aria-hidden="true" spy-title="Custom Inspector"><span class="octicon octicon-link"></span></a>Custom Inspector</h3><ul><li>Mục đích: hỗ trợ cấu hình giá trị trong Inspector của một GameObject đã add Script Component có đoạn code này<li>Thực hiện:<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if UNITY_EDITOR
</span><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
<span class="cp">#endif
</span><span class="p">...</span>
<span class="cp">#if UNITY_EDITOR
</span>  <span class="c1">// UITable là Script Component, hãy để đoạn code này cùng file 'UITable.cs'</span>
  <span class="p">[</span><span class="nf">CustomEditor</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">UITable</span><span class="p">),</span> <span class="k">true</span><span class="p">)]</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">UITableEditor</span> <span class="p">:</span> <span class="n">Editor</span>
  <span class="p">{</span>
      <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnInspectorGUI</span><span class="p">()</span>
      <span class="p">{</span>
          <span class="n">UITable</span> <span class="n">myTarget</span> <span class="p">=</span> <span class="p">(</span><span class="n">UITable</span><span class="p">)</span><span class="n">target</span><span class="p">;</span>
          <span class="nf">DrawDefaultInspector</span><span class="p">();</span> <span class="c1">// &lt;--- DONT FORGET THIS!!!</span>

          <span class="k">if</span> <span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"Update"</span><span class="p">))</span> <span class="c1">// &lt;--- thêm một button 'Update' và thực hiện 'UpdateTable' trong 'UITable'</span>
          <span class="p">{</span>
              <span class="n">myTarget</span><span class="p">.</span><span class="nf">UpdateTable</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
          <span class="p">}</span>
      <span class="p">}</span>

  <span class="p">}</span>
<span class="cp">#endif
</span></code></pre></div></div></ul><h3 id="draw-gizmos-với-gimozdrawutility"> <a class="anchor" href="#draw-gizmos-v%E1%BB%9Bi-gimozdrawutility" aria-hidden="true" spy-title="Draw Gizmos với GimozDrawUtility"><span class="octicon octicon-link"></span></a>Draw Gizmos với GimozDrawUtility</h3><ul><li>Mục đích: visualize một hướng di chuyển, không gian…<li>Thực hiện: bên trong Script MonoBehaviour triển khai ‘OnDrawGizmos’.</ul><div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">BasicTween</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="p">...</span>
    <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="p">...</span>
    <span class="err">#</span><span class="k">if</span> <span class="n">UNITY_EDITOR</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OnDrawGizmos</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">GimozDrawUtility</span><span class="p">.</span><span class="nf">GimozEnabled</span><span class="p">()</span> <span class="p">&amp;&amp;</span> <span class="n">_from</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">_to</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">GimozDrawUtility</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">);</span> <span class="c1">// GimozDrawUtility: DrawPoint, DrawLine, DrawRay, DrawRectangle, DrawGizmoCube, DrawBounds...</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="err">#</span><span class="n">endif</span>
<span class="p">}</span>

<span class="c1">// -------------------- Ví dụ Draw a Bound --------------------</span>
<span class="cp">#if UNITY_EDITOR
</span>    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnDrawGizmos</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">GimozDrawUtility</span><span class="p">.</span><span class="nf">GimozEnabled</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="nf">DrawBounds</span><span class="p">();</span> <span class="c1">// &lt;--- draw bounds</span>
            <span class="nf">DrawDebug</span><span class="p">();</span> <span class="c1">// &lt;--- debug khi play mode (Application.IsPlaying(gameObject))</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawBounds</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// init bounds for Editor</span>
        <span class="n">bounds</span><span class="p">.</span><span class="n">center</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
        <span class="n">bounds</span><span class="p">.</span><span class="n">extents</span> <span class="p">=</span> <span class="n">extends</span><span class="p">;</span>
        <span class="c1">// draw bounds</span>
        <span class="n">GimozDrawUtility</span><span class="p">.</span><span class="nf">DrawBounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">,</span> <span class="n">gameObject</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawDebug</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="nf">IsPlaying</span><span class="p">(</span><span class="n">gameObject</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">m_Enum</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="n">DebugEnum</span><span class="p">.</span><span class="n">RED</span><span class="p">:</span>
                    <span class="n">GimozDrawUtility</span><span class="p">.</span><span class="nf">DrawPoint</span><span class="p">(</span><span class="n">PlayerController</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">DebugEnum</span><span class="p">.</span><span class="n">YELLOW</span><span class="p">:</span>
                    <span class="n">GimozDrawUtility</span><span class="p">.</span><span class="nf">DrawPoint</span><span class="p">(</span><span class="n">PlayerController</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">yellow</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">DebugEnum</span><span class="p">.</span><span class="n">GREEN</span><span class="p">:</span>
                   <span class="n">GimozDrawUtility</span><span class="p">.</span><span class="nf">DrawPoint</span><span class="p">(</span><span class="n">PlayerController</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">green</span><span class="p">);</span>
                   <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>    
<span class="cp">#endif
</span></code></pre></div></div><h3 id="global-configuration-manager"> <a class="anchor" href="#global-configuration-manager" aria-hidden="true" spy-title="Global Configuration Manager"><span class="octicon octicon-link"></span></a>Global Configuration Manager</h3><ul><li>Cấu hình Global nên Script sẽ là MonoBehaviour và DontDestroyOnLoad(this.gameObject) ở ‘Awake()’<li>Script Component phải là một Singleton để truy cập được ở những chỗ khác<li>Sử dụng ‘GameConfigs : ScriptableObject’ thay vì ‘PlayerPref’ để lưu cấu hình mà người dùng đã set<li>Ví dụ: GlobalConfigurableManager.cs, GameConfigs.cs</ul><h3 id="xử-lý-start-và-load-scene-ở-các-levels"> <a class="anchor" href="#x%E1%BB%AD-l%C3%BD-start-v%C3%A0-load-scene-%E1%BB%9F-c%C3%A1c-levels" aria-hidden="true" spy-title="Xử lý Start và Load Scene ở các Levels"><span class="octicon octicon-link"></span></a>Xử lý Start và Load Scene ở các Levels</h3><ul><li>Mục đích: thực hiện LoadSceneAsync với thanh tiến độ<li>Script Component phải là một Singleton để truy cập được ở những chỗ khác (các Levels, Scene khi cần chuyển màn hình)<li>Ví dụ: StartAndLoadSceneController.cs, [Prefab] StartAndLoadSceneController</ul><h3 id="tự-implement-một-touch-control-mobile-joysticks"> <a class="anchor" href="#t%E1%BB%B1-implement-m%E1%BB%99t-touch-control-mobile-joysticks" aria-hidden="true" spy-title="Tự implement một Touch Control Mobile (Joysticks)"><span class="octicon octicon-link"></span></a>Tự implement một Touch Control Mobile (Joysticks)</h3><ul><li>Nguyên lý hoạt động:<ul><li>là phối hợp giữa ‘TouchControls’ và ‘TouchClickTracker’<li>‘TouchClickTracker’ cung cấp dữ liệu cho ‘TouchControls’<li>‘TouchControls’ cung cấp dữ liệu cho ‘GameInput’</ul><li>Nhược điểm: bị cố định vùng có thể touch<li>Ví dụ: TouchClickTracker.cs, TouchControls.cs, GameInput.cs</ul><h3 id="todo"> <a class="anchor" href="#todo" aria-hidden="true" spy-title="TODO…"><span class="octicon octicon-link"></span></a>TODO…</h3><ul><li>HUD<li>In-Game Menu<li>Managers: Time, Audio, Objective, Game…<li>BulletHell, Shooter</ul><h2 id="investigate"> <a class="anchor" href="#investigate" aria-hidden="true" spy-title="Investigate"><span class="octicon octicon-link"></span></a>Investigate</h2><h3 id="battlecity"> <a class="anchor" href="#battlecity" aria-hidden="true" spy-title="BattleCity"><span class="octicon octicon-link"></span></a>BattleCity</h3><h4 id="read-json"> <a class="anchor" href="#read-json" aria-hidden="true" spy-title="Read Json"><span class="octicon octicon-link"></span></a>Read Json</h4><div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Đọc file Text Json nằm trong thư mục 'Resources' (Resources/Maps/JsonText_*)</span>
<span class="n">TiledData</span> <span class="nf">ReadJson</span><span class="p">(</span><span class="kt">int</span> <span class="n">_mapLevel</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// UnityEngine.TextAsset là nội dung tệp văn bản. (text, bytes, GetPreview(int maxChars), DecodeString(byte[] bytes)...)</span>
    <span class="n">TextAsset</span> <span class="n">jsonData</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="n">TextAsset</span><span class="p">&gt;(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Maps/JsonText_{0}"</span><span class="p">,</span><span class="n">_mapLevel</span><span class="p">));</span>
    <span class="c1">// UnityEngine.JsonUtility chứa các hàm tiện ích để làm việc với dữ liệu JSON. (FromJson, FromJson&lt;T&gt;, ToJson...)</span>
    <span class="k">return</span> <span class="n">JsonUtility</span><span class="p">.</span><span class="n">FromJson</span><span class="p">&lt;</span><span class="n">TiledData</span><span class="p">&gt;(</span><span class="n">jsonData</span><span class="p">.</span><span class="n">text</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="c1">// TiledData, Layers, Properties giống như các object ORM...</span>
<span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">TiledData</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Layers</span><span class="p">&gt;</span> <span class="n">layers</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Layers</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">name</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">data</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Properties</span><span class="p">&gt;</span> <span class="n">properties</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Properties</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="k">value</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="khởi-tạo-map-và-enemies"> <a class="anchor" href="#kh%E1%BB%9Fi-t%E1%BA%A1o-map-v%C3%A0-enemies" aria-hidden="true" spy-title="Khởi tạo Map và Enemies"><span class="octicon octicon-link"></span></a>Khởi tạo Map và Enemies</h4><div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Load Map '_mapLevel' từ file Json</span>
<span class="c1">// 1. destroy các items có tag là 'Respawn' và clear các List</span>
<span class="c1">// 2. Đọc dữ liệu Map từ Json file</span>
<span class="c1">// 3. KHỞI TẠO Ground (Grass)</span>
<span class="c1">// 4. [init] dữ liệu Map (mapData) và ListEnemy (listProperties) dựa vào dữ liệu file Json (tiledData)</span>
<span class="c1">// 5. KHỞI TẠO các đối tượng (Brick, Rock, Tree, Water) trong Map</span>
<span class="c1">// 6. [init] dữ liệu List Enemy dựa trên giữ liệu thiết kế từ file Json (độ khó map: loại Enemy, số lượng mỗi loại), lúc này vẫn chưa khởi tạo</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">LoadMaps</span><span class="p">(</span><span class="kt">int</span> <span class="n">_mapLevel</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 1. destroy các items có tag là 'Respawn' và clear các List</span>
    <span class="nf">ClearMap</span><span class="p">();</span>

    <span class="c1">// 2. Đọc dữ liệu Map từ Json file</span>
    <span class="n">TiledData</span> <span class="n">tiledData</span> <span class="p">=</span> <span class="nf">ReadJson</span><span class="p">(</span><span class="n">_mapLevel</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">indexRow</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">indexCol</span> <span class="p">=</span> <span class="m">52</span><span class="p">;</span>
    <span class="kt">int</span><span class="p">[]</span> <span class="n">mapData</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[]{};</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="n">Properties</span><span class="p">&gt;</span> <span class="n">listProperties</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Properties</span><span class="p">&gt;();</span>
    
    <span class="c1">// 3. khởi tạo Ground (Grass) </span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">r</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">r</span> <span class="p">&lt;</span> <span class="m">13</span><span class="p">;</span> <span class="n">r</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">c</span> <span class="p">&lt;</span> <span class="m">13</span><span class="p">;</span> <span class="n">c</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="kt">float</span> <span class="n">x</span> <span class="p">=</span> <span class="n">c</span> <span class="p">*</span> <span class="m">4</span> <span class="p">+</span> <span class="m">2.5f</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">z</span> <span class="p">=</span> <span class="n">r</span> <span class="p">*</span> <span class="p">-</span><span class="m">4</span> <span class="p">-</span> <span class="m">2.5f</span><span class="p">;</span>
            <span class="n">Transform</span> <span class="n">grass</span> <span class="p">=</span> <span class="n">Instantiate</span><span class="p">&lt;</span><span class="n">Transform</span><span class="p">&gt;(</span><span class="n">Resources</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="n">Transform</span><span class="p">&gt;(</span><span class="s">$"Prefabs/Map_Grass_0</span><span class="p">{</span><span class="n">UnityEngine</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">)}</span><span class="s">"</span><span class="p">));</span>
            <span class="n">grass</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="n">z</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 4. init Map (mapData) và ListEnemy (listProperties) dựa vào dữ liệu file Json (tiledData)</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">tiledData</span><span class="p">.</span><span class="n">layers</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="s">"Map"</span><span class="p">:</span>
                <span class="n">mapData</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s">"ListEnemy"</span><span class="p">:</span>
                <span class="n">listProperties</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">properties</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// 5. khởi tạo các đối tượng (Brick, Rock, Tree, Water) trong Map</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">cubeInTiled</span> <span class="k">in</span> <span class="n">mapData</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// reset indexCol về 1 và giảm indexRow nếu indexCol &gt; 52 (giá trị ban đầu là 52)</span>
        <span class="n">indexCol</span><span class="p">++;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">indexCol</span> <span class="p">&gt;</span> <span class="m">52</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">indexCol</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
            <span class="n">indexRow</span><span class="p">--;</span>
        <span class="p">}</span>

        <span class="c1">// nếu mapData.item &gt; 0 (cubeInTiled &gt; 0): là vị trí các 'cube' (Brick, Rock, Tree, Water)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cubeInTiled</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Thêm đối tượng (Brick, Rock, Tree, Water) vào Dictionary</span>
            <span class="c1">// cubesOBJ là một Dictionary chứa các đối tượng (Brick, Rock, Tree, Water) có trong Map</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">cubesOBJ</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">cubeInTiled</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">cubesOBJ</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">cubeInTiled</span><span class="p">,</span> <span class="n">Resources</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="n">CubeEntity</span><span class="p">&gt;(</span><span class="n">String</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Prefabs/{0}"</span><span class="p">,</span> <span class="p">((</span><span class="n">CUBE_TYPE</span><span class="p">)</span><span class="n">cubeInTiled</span><span class="p">).</span><span class="nf">ToString</span><span class="p">())));</span>
            <span class="p">}</span>

            <span class="c1">// khởi tạo (Instantiate) đối tượng (Brick, Rock, Tree, Water)</span>
            <span class="n">CubeEntity</span> <span class="n">cube</span> <span class="p">=</span> <span class="n">Instantiate</span><span class="p">&lt;</span><span class="n">CubeEntity</span><span class="p">&gt;(</span><span class="n">cubesOBJ</span><span class="p">[</span><span class="n">cubeInTiled</span><span class="p">]);</span>
            <span class="n">cube</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetParent</span><span class="p">(</span><span class="n">transform</span><span class="p">);</span> <span class="c1">// group lại cho cùng Parent</span>
            <span class="n">Vector3</span> <span class="n">pos</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">indexCol</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">indexRow</span><span class="p">);</span> <span class="c1">// init pos dựa vào indexCol và indexRow</span>
            <span class="n">cube</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">pos</span><span class="p">;</span> <span class="c1">// init position</span>
            <span class="n">cube</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">DOLocalMoveY</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0.2f</span><span class="p">).</span><span class="nf">From</span><span class="p">(-</span><span class="m">3</span><span class="p">).</span><span class="nf">SetDelay</span><span class="p">((-</span><span class="n">indexRow</span><span class="p">)</span> <span class="p">*</span><span class="m">0.1f</span><span class="p">);</span> <span class="c1">// sử dụng Tween để animate</span>
            <span class="c1">// quản lý Tree list</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cube</span><span class="p">.</span><span class="n">cubeType</span> <span class="p">==</span> <span class="n">CUBE_TYPE</span><span class="p">.</span><span class="n">Tree</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">listTree</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">cube</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">listCube</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">cube</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
    <span class="p">}</span>
    <span class="c1">//Debug.Log(string.Format("{0} : x = {1}, y = {2}", tiledData.layers[1].objects[0].name, tiledData.layers[1].objects[0].x, tiledData.layers[1].objects[0].y));</span>

    <span class="c1">// 6. init List Enemy dựa trên giữ liệu thiết kế từ file Json (độ khó map: loại Enemy, số lượng mỗi loại)</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">properties</span> <span class="k">in</span> <span class="n">listProperties</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">properties</span><span class="p">.</span><span class="k">value</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">listEnemys</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">properties</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// KHỞI TẠO Enemies: Lấy Random một Enemy trong danh sách (string) và khởi tạo nó ở vị trí _spawPos</span>
<span class="k">public</span> <span class="kt">bool</span> <span class="nf">CreateEnemy</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">_spawPos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">listEnemys</span><span class="p">.</span><span class="n">Count</span><span class="p">&gt;</span><span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">indexOfEnemy</span> <span class="p">=</span> <span class="n">UnityEngine</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">listEnemys</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
        <span class="n">Instantiate</span><span class="p">&lt;</span><span class="n">EnemyEntity</span><span class="p">&gt;(</span>
            <span class="n">Resources</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="n">EnemyEntity</span><span class="p">&gt;(</span>
                <span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Prefabs/{0}"</span><span class="p">,</span> <span class="n">listEnemys</span><span class="p">[</span><span class="n">indexOfEnemy</span><span class="p">])),</span> <span class="n">_spawPos</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">.</span><span class="n">identity</span><span class="p">);</span>
        <span class="n">listEnemys</span><span class="p">.</span><span class="nf">RemoveAt</span><span class="p">(</span><span class="n">indexOfEnemy</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="sử-dụng-setter-để-implement-luồng-game"> <a class="anchor" href="#s%E1%BB%AD-d%E1%BB%A5ng-setter-%C4%91%E1%BB%83-implement-lu%E1%BB%93ng-game" aria-hidden="true" spy-title="Sử dụng Setter để implement luồng game"><span class="octicon octicon-link"></span></a>Sử dụng Setter để implement luồng game</h4><ul><li>Start(): status = GAME_STATUS.LoadMap &gt; Setter<li>Setter: case GAME_STATUS.LoadMap &gt; xong sẽ set status = GAME_STATUS.Init<li>Setter: case GAME_STATUS.Init &gt; khởi tạo các chỉ số (player) và CreateEnemy…</ul><h4 id="joystick"> <a class="anchor" href="#joystick" aria-hidden="true" spy-title="Joystick"><span class="octicon octicon-link"></span></a>Joystick</h4><div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Update() &gt; if(status == GAME_STATUS.Play) &gt; Joystick();</span>
<span class="k">void</span> <span class="nf">Joystick</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Nếu đang Click chuột hoặc Touch (thời điểm Click)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetMouseButtonDown</span><span class="p">(</span><span class="m">0</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// kiểm tra xem có Touch vào HUD hoặc Button (AttackButton) hay không?</span>
        <span class="c1">// UnityEngine.RectTransformUtility: Lớp tiện ích chứa các phương thức trợ giúp để làm việc với RectTransform.</span>
        <span class="n">isTouchOnUI</span> <span class="p">=</span> <span class="n">RectTransformUtility</span><span class="p">.</span><span class="nf">RectangleContainsScreenPoint</span><span class="p">(</span><span class="n">AttackButton</span><span class="p">,</span> <span class="n">Input</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">||</span> <span class="n">RectTransformUtility</span><span class="p">.</span><span class="nf">RectangleContainsScreenPoint</span><span class="p">(</span><span class="n">BackgroundUI</span><span class="p">,</span> <span class="n">Input</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isTouchOnUI</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// nếu isTouchOnUI = true thì dừng xử lý (không thuộc về Joystick)</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">startTouchPos</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">;</span> <span class="c1">// init dữ liệu vị trí Touch</span>
        <span class="n">poinJoy</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">poinCenter</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">startTouchPos</span><span class="p">;</span> <span class="c1">// thay đổi vị trí Joystick Prefab và Joystick Image về vị trí Touch</span>
        <span class="n">poinCenter</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">true</span><span class="p">);</span> <span class="c1">// active Joystick Prefab</span>
        <span class="n">poinJoy</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">true</span><span class="p">);</span> <span class="c1">// active Joystick Image</span>
    <span class="p">}</span>
    <span class="c1">// Nếu user nhả chuột hoặc bỏ Touch ở các vị tri thuộc về Joystick (thời điểm Thả)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetMouseButtonUp</span><span class="p">(</span><span class="m">0</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">isTouchOnUI</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// reset vị trí Joystick Prefab và Joystick Image</span>
        <span class="n">poinJoy</span><span class="p">.</span><span class="n">localPosition</span> <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
        <span class="n">poinCenter</span><span class="p">.</span><span class="n">localPosition</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(-</span><span class="m">300</span><span class="p">,-</span><span class="m">440</span><span class="p">);</span>
        <span class="c1">// deactive các arrow</span>
        <span class="nf">SetArrowVisible</span><span class="p">(</span><span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Nếu người dùng giữ chuột hoặc keep Touch ở các vị tri thuộc về Joystick (Hold)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetMouseButton</span><span class="p">(</span><span class="m">0</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">isTouchOnUI</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Ghi nhận vị trí, phạm vi và khoảng cách</span>
        <span class="n">Vector2</span> <span class="n">endTouch</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">range</span> <span class="p">=</span> <span class="n">Screen</span><span class="p">.</span><span class="n">width</span> <span class="p">/</span> <span class="m">1080f</span> <span class="p">*</span> <span class="m">80f</span><span class="p">;</span> <span class="c1">// hardcode...</span>
        <span class="kt">float</span> <span class="n">distance</span> <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="nf">Distance</span><span class="p">(</span><span class="n">endTouch</span><span class="p">,</span> <span class="n">startTouchPos</span><span class="p">);</span>

        <span class="c1">// Validate endTouch</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">distance</span> <span class="p">&gt;</span> <span class="n">range</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//startTouchPos = LerpByDistance(startTouchPos, endTouch, range);</span>
            <span class="n">endTouch</span> <span class="p">=</span> <span class="n">startTouchPos</span> <span class="p">+</span> <span class="p">(</span><span class="n">endTouch</span> <span class="p">-</span> <span class="n">startTouchPos</span><span class="p">).</span><span class="n">normalized</span><span class="p">*</span><span class="n">range</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// thay đổi vị trí Joystick Prefab và Joystick Image</span>
        <span class="n">poinCenter</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">startTouchPos</span><span class="p">;</span>
        <span class="n">poinJoy</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">endTouch</span><span class="p">;</span>

        <span class="c1">// Xác định hướng Drag và vector 'directionTouch'</span>
        <span class="n">Vector2</span> <span class="n">directionTouch</span> <span class="p">=</span> <span class="p">(</span><span class="n">endTouch</span> <span class="p">-</span> <span class="n">startTouchPos</span><span class="p">).</span><span class="n">normalized</span> <span class="p">*</span> <span class="m">10f</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Mathf</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">directionTouch</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">directionTouch</span><span class="p">.</span><span class="n">y</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">directionTouch</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">directionTouch</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Kiểm tra khoảng cách Joystick di chuyển so với khoảng cách tối thiểu (40f)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">distance</span> <span class="p">&gt;</span> <span class="m">40f</span><span class="p">)</span> <span class="c1">// hardcode...</span>
        <span class="p">{</span>
            <span class="nf">SetArrowVisible</span><span class="p">(</span><span class="n">directionTouch</span><span class="p">);</span> <span class="c1">// Hiển thị Arrow Indicator</span>
            <span class="n">player</span><span class="p">.</span><span class="nf">Move</span><span class="p">(</span><span class="n">directionTouch</span><span class="p">);</span> <span class="c1">// Move Player</span>
        <span class="p">}</span> <span class="k">else</span>
        <span class="p">{</span>
            <span class="nf">SetArrowVisible</span><span class="p">(</span><span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">);</span> <span class="c1">// Ẩn các arrow</span>
        <span class="p">}</span>
        <span class="c1">//Vector3 pos = new Vector3(arrow.x, 0, arrow.y);</span>
        <span class="c1">//transform.position = Vector3.Lerp(transform.position, transform.position + pos, speed);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="battlecity-take-note"> <a class="anchor" href="#battlecity-take-note" aria-hidden="true" spy-title="BattleCity Take Note"><span class="octicon octicon-link"></span></a>BattleCity Take Note</h4><ul><li>Attack Button: <strong>Onclick()</strong> &gt; <em>Ref:GameManager</em> &gt; public void <strong>Shot()</strong><li>Player Structure: gồm RootModel + <strong>Canvas</strong> (Mode: World Space) để hiển thị ‘<strong>HealthBar</strong>’<li>Player Move: di chuyển theo vị trí ô. <strong>Speed</strong> được xử lý với <strong>Vector3.Lerp()</strong>. Khi move cần kết hợp với “<strong>CheckMoveWithMap</strong>” nếu vị trí mới là các đối tượng <em>(Brick, Rock, Tree, Water)</em><li> <strong>GameManager</strong> sẽ <em>call bullet.OnUpdate() và enemy.OnUpdate() ở Update()</em> để kích hoạt xử lý tiếp theo của <strong>bullet</strong> và <strong>enemies</strong><li>OOP:<ul><li>TankEntity: TankData, BulletData, Move(), Shot(), Hit(), LevelUp()…<ul><li>PlayerEntity (TankEntity): override[OnStart(), Hit(float damage), LevelUp(int level = 0)]<li>EnemyEntity (TankEntity): override[OnStart(), OnUpdate(), Hit(float damage)]</ul><li>Other Entities: BulletEntity, CubeEntity, LevelEntity<li>ScriptableObject: TankLevelData</ul><li>Plugins:<ul><li>Demigiant<ul><li>DOTween</ul></ul></ul><h2 id="linh-tinh"> <a class="anchor" href="#linh-tinh" aria-hidden="true" spy-title="Linh tinh"><span class="octicon octicon-link"></span></a>Linh tinh</h2><ul><li>Package Manager Download Directory:<ul><li>Windows: <code class="highlighter-rouge">C:\Users\[your-user]\AppData\Local\Unity\cache\packages\packages.unity.com</code><li>Mac: <code class="highlighter-rouge">~/Library/Unity/cache hoặc &lt;project_path&gt;/Library/PackageCache</code></ul></ul></div></div></article><div class="w3-padding-16"></div><div class="opacity-transition-hover konamiHide"><h5>Xem thêm các bài viết khác cùng chủ đề</h5><ul class="w3-ul"><li><span></span>→ [Unity Coding] How-To · 18 mins read</ul></div><script src="/assets/js/search-custom.min.js" type="text/javascript"></script> <script> (function() { JSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('results-container'), json: '/search/search-collections.json' }) })(); </script><div id="qModal" class="w3-modal"><div class="w3-modal-content"><div class="w3-container"> <span onclick="document.getElementById('qModal').style.display='none'" class="w3-button w3-display-topright">&times;</span><div><p id="qModalSentenceEmpty" class="w3-panel"><hr><p id="qModalSentencePice" class="w3-panel"><p id="qModalAnswerMsg" class="w3-panel" style="display: none;"><span class="w3-red">Không đúng rôi! thử lại đi...</span><hr><p class="w3-panel"> <button class="material-icons w3-btn w3-border" id="qModalAudioControlEl" onclick="qModalAudioControlPlay()" title="Play the sound" disabled>play_arrow</button> <button class="material-icons w3-btn w3-border" id="qModalResetQuizEl" onclick="qModalResetQuiz()" title="Reset the quiz">cached</button> <button class="material-icons w3-btn w3-border" id="qModalGiveUpAndShowAnswerEl" onclick="qModalGiveUpAndShowAnswer()" title="Give up...">bolt</button> <button class="w3-btn w3-white w3-border" onclick="clearFormTextArea()" title="Clear the textarea" disabled>Clear</button><p id="qModalSentenceTypeArea" class="w3-panel"> <textarea id="sentenceTypeAreaId" style="margin: 0px;width: 100%;height: 99px;" onkeyup="qModalTxtAreaOnkeyup()"></textarea></div><div id="qModalTotoList" class="w3-container"><ul id="myUL"><li onclick="onClickTodoList(this)">1. Làm quiz hoàn thành câu<li onclick="onClickTodoList(this)">2. Nghe Audio và nhại theo 3 lần<li onclick="onClickTodoList(this)">3. Tự nói lại mà không nghe Audio và nhìn vào chữ đúng 3 lần<li onclick="onClickTodoList(this)">4. Gõ lại câu đến khi chính xác<li onclick="onClickTodoList(this)">5. Phân tích cú pháp và lấy ví dụ tương tự (thay các từ loại, chủ ngữ, nếu là câu hỏi thì trả lời câu hỏi)</ul></div><div class="w3-panel"></div></div></div></div><style> #qModalTotoList ul { list-style: none; margin: 0; padding: 0; } /* Style the list items */ #qModalTotoList ul li { cursor: pointer; position: relative; padding: 12px 8px 12px 40px; background: #eee; font-size: 18px; transition: 0.2s; /* make the list items unselectable */ -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } /* Set all odd list items to a different color (zebra-stripes) */ #qModalTotoList ul li:nth-child(odd) { background: #f9f9f9; } /* Darker background-color on hover */ #qModalTotoList ul li:hover { background: #ddd; } /* When clicked on, add a background color and strike out text */ #qModalTotoList ul li.checked { background: #888; color: #fff; text-decoration: line-through; } /* Add a "checked" mark when clicked on */ #qModalTotoList ul li.checked::before { content: ''; position: absolute; border-color: #fff; border-style: solid; border-width: 0 2px 2px 0; top: 10px; left: 16px; transform: rotate(45deg); height: 15px; width: 7px; } /* Style the close button */ #qModalTotoList .close { position: absolute; right: 0; top: 0; padding: 12px 16px 12px 16px; } #qModalTotoList .close:hover { background-color: #f44336; color: white; }</style><script> /* toggle 'checked' class on Todo list */ function onClickTodoList(thisVar) { thisVar.classList.toggle('checked'); } /* Create a "close" button and append it to each list item */ function appendCloseButton() { var myNodelist = document.getElementsByTagName("LI"); var i; for (i = 0; i < myNodelist.length; i++) { var span = document.createElement("SPAN"); var txt = document.createTextNode("\u00D7"); span.className = "close"; span.appendChild(txt); myNodelist[i].appendChild(span); } } /* Click on a close button to hide the current list item */ function addOnclickToCloseButton() { var close = document.getElementsByClassName("close"); var i; for (i = 0; i < close.length; i++) { close[i].onclick = function () { var div = this.parentElement; div.style.display = "none"; } } } /* Add a "checked" symbol when clicking on a list item */ function addEventClickOnList() { var list = document.querySelector('ul'); list.addEventListener('click', function (ev) { if (ev.target.tagName === 'LI') { ev.target.classList.toggle('checked'); } }, false); } /* Create a new list item when clicking on the "Add" button */ function newElement() { var li = document.createElement("li"); var inputValue = document.getElementById("myInput").value; var t = document.createTextNode(inputValue); li.appendChild(t); if (inputValue === '') { alert("You must write something!"); } else { document.getElementById("myUL").appendChild(li); } document.getElementById("myInput").value = ""; var span = document.createElement("SPAN"); var txt = document.createTextNode("\u00D7"); span.className = "close"; span.appendChild(txt); li.appendChild(span); for (i = 0; i < close.length; i++) { close[i].onclick = function () { var div = this.parentElement; div.style.display = "none"; } } } </script></main><div id="tocMenu" class="tocMenu" onclick="toggleTOC()"><div class="progress-bar" id="progressBar"></div><div title="Table Of Content" class="w3-btn w3-border w3-border-blue w3-white"> Outline</div></div><div id="audioControlGroup" class="w3-animate-opacity"><p> <span class="material-icons w3-button w3-border w3-border-blue" onclick="audioControlMinus()" title="Minus">history</span> <span class="material-icons w3-button w3-border w3-border-blue" onclick="resetCurrentAudio()" title="Reset">cached</span><p> <span class="material-icons w3-button w3-border w3-border-blue" id="audioControlEl" onclick="audioControlPlayOrPause()" title="Play/Pause">play_arrow</span> <span class="material-icons w3-button w3-border w3-border-blue" onclick="onClickGotoCurrentAudio()" title="Go to Current Audio">arrow_right_alt</span><p> <span class="material-icons w3-button w3-border w3-border-blue" onclick="audioControlPlus()" title="Plus">update</span> <span class="material-icons w3-button w3-border w3-border-blue" onclick="skipCurrentAudioAndNext()" title="Next">skip_next</span><p> <span class="material-icons w3-button w3-border w3-border-blue" onclick="openMemo()" title="Your Note">create</span> <span class="material-icons w3-button w3-border w3-border-blue" onclick="onClickShowAudioControl()" title="Hide Audio Control">close</span><p> <span class="material-icons w3-button w3-border w3-border-blue" onclick="openAudioSettings()" title="Audio Settings">settings</span> <span class="material-icons w3-button w3-border w3-border-blue" onclick="gotoBottom()" title="Go to bottom">arrow_downward</span></div><link rel="stylesheet" href="/assets/css/quill.1.3.6.snow.css" media="none" onload="if(media!='all')media='all'"> <noscript><link rel="stylesheet" href="/assets/css/quill.1.3.6.snow.css"></noscript><div id="quillNote" class="w3-modal"><div class="w3-modal-content w3-card-4 w3-animate-top" style="max-width:600px"><header class="w3-container light-grey"> <span onclick="document.getElementById('quillNote').style.display='none'" class="w3-button w3-hover-red w3-xlarge w3-display-topright">&times;</span><h2>Memo</h2></header><div class="w3-container w3-section"><div id="quillNoteEditor"></div></div><div class="w3-container w3-light-grey w3-padding"> <button class="w3-button w3-right w3-white w3-border" onclick="onNoteSave()">Save</button></div></div></div><script src="/assets/js/quill.1.3.6.js" type="text/javascript" async></script> <script type="text/javascript"> function openMemo() { try { document.getElementById('audioSettings').style.display='none'; } catch (error) { console.log(error); } toggleElmDisplay(document.getElementById('quillNote')); } function onNoteSave() { const pathKey = window.location.pathname; window.localStorage.setItem(pathKey, window.quillEditor.getHTML()); document.getElementById('quillNote').style.display = 'none'; } function loadMemo() { const pathKey = window.location.pathname; const memo = window.localStorage.getItem(pathKey); if (memo) { window.quillEditor.setHTML(memo); } } </script> <button onclick="topFunction()" title="Go to Top" id="scrollTopBtn" class="w3-btn w3-border w3-border-blue w3-white">Top</button><div id="zoomModal" class="w3-modal w3-center w3-animate-opacity" onclick="this.style.display='none'"> <img class="w3-modal-content w3-mobile w3-animate-zoom" style="width: 100%;" id="imgModal"></div><script type="text/javascript"> function openAudioControl() { } </script><footer class="w3-center w3-padding-16 dh-clear"></footer><div id="snackbar">...</div></div><div id="modalUnderMaintenance" class="w3-modal"> <span class="w3-button w3-hover-red w3-xlarge w3-display-topright" onclick="document.getElementById('modalUnderMaintenance').style.display='none'">&times;</span><div class="w3-modal-content w3-animate-zoom"> <img src="/assets/img/articles/demo/helloworld4.jpg" style="width:100%"><h2 class="w3-padding w3-display-middle w3-white" onclick="document.getElementById('modalUnderMaintenance').style.display='none'">Under Maintenance</h2></div></div><script src="/assets/js/quote-api.js" type="text/javascript" async></script> <script src="/assets/js/custom.js" type="text/javascript" async></script> <script src="/assets/js/custom_test.js" type="text/javascript" async></script><link href="/assets/css/tango-highlight.css" rel="stylesheet" media="all">
